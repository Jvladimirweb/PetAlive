<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>PetAlive • Cadastro</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body { font-family: Arial; background:#f4f6f8; padding:20px; }
.container { max-width:520px; margin:auto; background:#fff; border-radius:14px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,.08); }
label { display:block; margin-top:12px; font-size:13px; }
input { width:100%; padding:12px; border-radius:10px; border:1px solid #ccc; margin-top:6px; }
button { width:100%; margin-top:16px; padding:13px; background:#2fbf5b; color:#fff; border:0; border-radius:10px; font-weight:bold; cursor:pointer; }
button:disabled { opacity:.6; }
.error { margin-top:14px; padding:12px; border-radius:12px; background:#fff2f2; border:1px solid #ffd0d0; color:#a40000; display:none; }
.result { margin-top:18px; display:none; padding:14px; background:#f1fff5; border-radius:12px; border:1px solid #c8f5d2; }
.petid { font-weight:bold; margin-top:8px; font-size:18px; }
</style>
</head>

<body>

<div class="container">
  <h2>Cadastro PetAlive</h2>

  <form id="petForm">
    <label>Nome do pet</label>
    <input name="petNome" required>

    <label>Tipo</label>
    <input name="tipo" required>

    <label>Raça</label>
    <input name="raca" required>

    <label>Nome do tutor</label>
    <input name="tutor" required>

    <label>WhatsApp (apenas números)</label>
    <input name="contato" pattern="[0-9]{10,13}" required>

    <label>Foto do pet</label>
    <input type="file" name="foto" accept="image/*" required>

    <button id="btnSubmit" type="submit">Cadastrar Pet</button>
  </form>

  <div class="error" id="errorBox"></div>

  <div class="result" id="resultBox">
    ✅ Pet cadastrado com sucesso!
    <div class="petid" id="resultPetId"></div>
  </div>
</div>

<script>
const N8N_WEBHOOK_URL = "https://bbd6-2804-14d-5c77-8c5b-9d0e-bc5c-6d57-bf58.ngrok-free.app/webhook/pet-create";

const form = document.getElementById("petForm");
const btn = document.getElementById("btnSubmit");
const errorBox = document.getElementById("errorBox");
const resultBox = document.getElementById("resultBox");
const resultPetId = document.getElementById("resultPetId");

function showError(msg){
  errorBox.style.display = "block";
  errorBox.textContent = msg;
}

function clearUI(){
  errorBox.style.display = "none";
  errorBox.textContent = "";
  resultBox.style.display = "none";
  resultPetId.textContent = "";
}

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  clearUI();

  btn.disabled = true;
  btn.textContent = "Enviando...";

  try {
    const fd = new FormData(form);

    const res = await fetch(N8N_WEBHOOK_URL, {
      method: "POST",
      mode: "cors",
      headers: {
        "ngrok-skip-browser-warning": "true"
      },
      body: fd
    });

    const text = await res.text();

    if (!res.ok) {
      showError("Erro no servidor.\n\n" + text);
      return;
    }

    let data;
    try { data = JSON.parse(text); } catch {}

    if (!data || data.ok !== true) {
      showError("Resposta inesperada do servidor.\n\n" + text);
      return;
    }

    resultPetId.textContent = "Pet ID: " + (data.petId || "-");
    resultBox.style.display = "block";

  } catch (err) {
    showError("Erro de conexão.\n\n" + err.message);
  }

  btn.disabled = false;
  btn.textContent = "Cadastrar Pet";
});
</script>

</body>
</html>
